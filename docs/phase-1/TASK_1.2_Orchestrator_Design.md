# ğŸ§  TASK 1.2 â€” Backend Orchestrator Design

**ĞŸÑ€Ğ¾ĞµĞºÑ‚:** Digital Denis  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾  
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹  
**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** TASK 1.1

---

## ğŸ“‹ Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

- [x] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ backend/orchestrator/router.py
- [x] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ backend/orchestrator/context.py
- [x] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ backend/orchestrator/profile.py
- [x] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- [x] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°
- [x] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ±Ğ¾Ñ€ĞºÑƒ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
- [x] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ unit-Ñ‚ĞµÑÑ‚Ñ‹

---

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ

ĞĞ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ Backend Orchestrator: Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ, ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹, Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸.

---

## ğŸ“¦ ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹

### 1. ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Orchestrator

Orchestrator â€” **Ñ†ĞµĞ½Ñ‚Ñ€ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ñ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹** ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹. ĞĞ½:

| Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---------|----------|
| **Request Classification** | ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° (strategic/analytical/operational/reflexive) |
| **Agent Selection** | Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° |
| **Context Assembly** | Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚: Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ + Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ + ÑĞµÑÑĞ¸Ñ |
| **Profile Enforcement** | ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Digital Profile |
| **Response Routing** | Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ² Interface Layer |

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** Orchestrator Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ²ÑĞµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, LLM â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ.

---

### 2. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Orchestrator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKEND ORCHESTRATOR                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   REQUEST ROUTER                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  Classifier â”‚  â”‚   Selector  â”‚  â”‚  Validator  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  (LLM-lite) â”‚  â”‚  (Rules)    â”‚  â”‚  (Profile)  â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 DIGITAL PROFILE ENGINE                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚   Loader    â”‚  â”‚  Validator  â”‚  â”‚  Injector   â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  (YAML)     â”‚  â”‚  (Schema)   â”‚  â”‚  (Context)  â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   CONTEXT MANAGER                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  Session    â”‚  â”‚   Memory    â”‚  â”‚  Assembler  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  Manager    â”‚  â”‚  Retriever  â”‚  â”‚  (Builder)  â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

#### 3.1 Request Router

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ |
|-----------|------------|------------|
| **Classifier** | ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° | LLM-lite (cheap model) Ğ¸Ğ»Ğ¸ rules |
| **Selector** | Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ° Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ | Rule-based mapping |
| **Validator** | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ | Profile constraints check |

**ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²:**

| Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞĞ³ĞµĞ½Ñ‚ |
|-----|----------|-------|
| `strategic` | Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ | Core Agent |
| `analytical` | ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ñ†Ğ¸Ñ„Ñ€, Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ | Analyst Agent |
| `operational` | ĞŸÑ€ĞµĞ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¸Ğ´ĞµĞ¹ Ğ² Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ | Operator Agent |
| `reflexive` | Ğ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¼, Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸, Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ | Memory Agent |
| `meta` | Ğ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°Ñ… Ğ¼Ñ‹ÑˆĞ»ĞµĞ½Ğ¸Ñ | Meta-Analyst Agent |

#### 3.2 Digital Profile Engine

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Input â†’ Output |
|-----------|------------|----------------|
| **Loader** | Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¸Ğ· YAML | File â†’ ProfileModel |
| **Validator** | Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ | ProfileModel â†’ Valid/Error |
| **Injector** | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ | Profile â†’ Context |

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ (denis.yaml):**

```yaml
profile:
  name: "Denis"
  thinking_style:
    - systematic
    - cause-effect
    - architectural
  
  principles:
    - "model first, then actions"
    - "numbers over words"
    - "chaos = management error"
  
  constraints:
    forbidden_patterns:
      - "Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ"
      - "Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, ÑÑ‚Ğ¾Ğ¸Ñ‚"
      - "Ñ Ğ½Ğµ ÑĞºÑĞ¿ĞµÑ€Ñ‚, Ğ½Ğ¾"
    forbidden_references:
      - "Apple"
      - "Google"
      - "Tesla"
    
  terminology:
    "ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹": "ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ³Ğ¾ÑÑ‚ĞµĞ¹"
    "Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚Ğ½Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ": "Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ° Ñ€Ğ¾Ğ»Ğ¸"
    
  response_format:
    style: structured
    tone: calm_business
    prefer: [lists, tables, schemas]
```

#### 3.3 Context Manager

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Source |
|-----------|------------|--------|
| **Session Manager** | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑĞµÑÑĞ¸ĞµĞ¹ | Redis |
| **Memory Retriever** | ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ | PostgreSQL + Vector DB |
| **Assembler** | Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° | All sources |

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°:**

```python
@dataclass
class AgentContext:
    # User request
    message: str
    message_type: str  # strategic/analytical/...
    
    # Digital Profile
    profile: DigitalProfile
    
    # Session
    session_id: str
    conversation_history: List[Message]  # Last N messages
    
    # Memory
    relevant_memories: List[MemoryItem]
    active_topics: List[Topic]
    
    # Metadata
    timestamp: datetime
    request_id: str
```

---

### 4. Sequence Diagram â€” ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚ User â”‚     â”‚Interface â”‚     â”‚Orchestrâ”‚     â”‚Memory â”‚     â”‚Agentâ”‚     â”‚ LLM â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚ 1. Message   â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚ 2. Forward    â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ 3. Classify   â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”        â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚      â”‚        â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚<â”€â”€â”€â”€â”€â”˜        â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ type=strategicâ”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ 4. Get contextâ”‚            â”‚           â”‚
   â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ 5. Return     â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ memories+session            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ 6. Assemble context         â”‚           â”‚
   â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”        â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚      â”‚        â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚<â”€â”€â”€â”€â”€â”˜        â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ 7. Select Agent=Core        â”‚           â”‚
   â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚ 8. Call   â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚ 9. Response
   â”‚              â”‚               â”‚               â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚ 10. Save?  â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚ (async)    â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚ 11. Response  â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚ 12. Format    â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚ 13. Display  â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚            â”‚           â”‚
   â”‚              â”‚               â”‚               â”‚            â”‚           â”‚
```

---

### 5. API ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ Orchestrator

#### Internal API (Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸)

```python
# orchestrator/router.py
class RequestRouter:
    async def classify(self, message: str) -> RequestType:
        """Classify request type using rules or LLM-lite"""
        
    async def select_agent(self, request_type: RequestType) -> AgentType:
        """Select appropriate agent based on request type"""
        
    async def process(self, message: str, session_id: str) -> AgentResponse:
        """Full request processing pipeline"""

# orchestrator/context.py  
class ContextManager:
    async def get_session(self, session_id: str) -> Session:
        """Get or create session from Redis"""
        
    async def get_relevant_memories(self, query: str, limit: int = 5) -> List[MemoryItem]:
        """Semantic search for relevant memories"""
        
    async def assemble(self, message: str, session: Session, 
                       memories: List[MemoryItem]) -> AgentContext:
        """Assemble full context for agent"""

# orchestrator/profile.py
class DigitalProfileEngine:
    def load(self, profile_path: str) -> DigitalProfile:
        """Load profile from YAML file"""
        
    def validate_response(self, response: str, profile: DigitalProfile) -> bool:
        """Check response against profile constraints"""
        
    def inject_constraints(self, prompt: str, profile: DigitalProfile) -> str:
        """Add profile constraints to agent prompt"""
```

---

## âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ

- [x] ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ñ‡Ñ‘Ñ‚ĞºĞ¾ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ°
- [x] Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹
- [x] Sequence diagram Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ flow
- [x] Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ñ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ñ‹

---

## ğŸ“ Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹

- [TASK 1.1 â€” Repo Structure](./TASK_1.1_Repo_Structure.md)
- [TASK 1.3 â€” Agent Specification](./TASK_1.3_Agent_Specification.md)
- [TASK 0.1 â€” Architecture Overview](../phase-0/TASK_0.1_Architecture_Overview.md)
