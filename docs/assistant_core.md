# assistant_core.md  
## Core-модуль «Личный помощник»  
Проект: Digital Den  
Статус: Draft → Implementation Ready  

---

## 1. Назначение модуля

**Личный помощник** — это центральный интеллектуальный модуль системы Digital Den, реализующий персонального AI-агента пользователя.

Модуль отвечает за:
- интерпретацию намерений пользователя;
- применение пользовательских правил (Rules);
- работу с памятью;
- планирование действий;
- инициативную и адаптивную помощь.

Личный помощник **не является чатом**.  
Он является **исполнителем воли пользователя**, действующим в рамках заданных правил, контекста и ограничений.

---

## 2. Роль модуля в архитектуре проекта

Личный помощник располагается **поверх LLM**, выступая как orchestration-layer.

UI / API
↓
Assistant Core
├─ Rules Engine
├─ Memory Engine
├─ Intent Analyzer
├─ Action Planner
└─ Response Controller
↓
LLM / External Tools


Модуль **не привязан к конкретной модели** (GPT / Claude / Gemini).

---

## 3. Ключевые принципы

1. **User-Controlled AI**
   - Пользователь управляет логикой, стилем и границами ИИ.

2. **Rule-First**
   - Правила имеют приоритет над эвристиками модели.

3. **Context-Aware**
   - Любое действие зависит от активного контекста.

4. **Explainability**
   - Помощник может объяснить, почему он так ответил или предложил действие.

5. **Non-Passive**
   - По умолчанию помощник инициативен (уровень настраивается).

---

## 4. Функциональные блоки

### 4.1 Intent Analyzer

Определяет:
- тип запроса (вопрос / задача / эмоция / рассуждение);
- скрытое намерение;
- необходимость уточнений;
- риск или неопределённость.

Выход:
```json
{
  "intent": "problem_solving",
  "confidence": 0.87,
  "requires_clarification": false,
  "emotional_state": "neutral"
}

4.2 Rules Engine

Обрабатывает правила пользователя, влияющие на поведение помощника.

Типы правил:

Global Rules — действуют всегда

Context Rules — зависят от активного контекста

Mode Rules — зависят от роли помощника

Safety Rules — ограничения и запреты

Формат (IDE-style, YAML):
rules:
  - if: context == "business"
    then:
      - prioritize: numbers
      - tone: formal
      - challenge_assumptions: true

  - if: emotion == "stress"
    then:
      - simplify_response: true
      - offer_next_step: true
Правила:

интерпретируемые

редактируемые пользователем

версионируемые

4.3 Memory Engine

Отвечает за хранение и использование памяти.

Типы памяти:

core — долгосрочные факты о пользователе

project — знания в рамках проекта

context — временный активный контекст

behavioral — предпочтения взаимодействия

historical — решения и их последствия

Операции:

add

update

delete

mark (importance, ttl)

bind to context

4.4 Роли помощника (Assistant Modes)

Помощник работает в активной роли:

Thinker — логика и рассуждения

Business Assistant — решения и документы

Analyst — цифры, модели, гипотезы

Navigator — что делать дальше

Mentor — обучение и развитие

Communicator — тексты и переговоры

Роль:

задаётся вручную

или определяется автоматически

4.5 Action Planner

Решает, что делать, а не только что ответить.

Возможные действия:

ответить

задать уточняющий вопрос

предложить план

разбить задачу

сохранить в память

напомнить о контексте

указать на ошибку мышления

4.6 Initiative Controller

Уровень инициативности:
initiative_level: "low" | "medium" | "high"
low — только ответы

medium — предложения и уточнения

high — активные вмешательства и проверки логики
4.7 Explain Mode

Режим прозрачности мышления:

answer_only

short_reasoning

full_reasoning

Выбирается:

пользователем

или через Rules

5. Управление состояниями

Помощник всегда знает:

текущий контекст

активную роль

применённые правила

границы инициативы

доступ к памяти

Все состояния должны быть:

сериализуемы

восстанавливаемы

видимы пользователю (UI)

6. UI-интеграция (логика)

Раздел «Личный помощник» включает:

текущую роль

активный контекст

список применённых правил

индикатор памяти

уровень инициативы

режим объяснений

UI не управляет логикой напрямую — только состояниями.

7. Безопасность и контроль

Пользователь может:

запретить сохранение памяти

отключить инициативу

ограничить типы действий

включить режим «Только отвечай»

Все ограничения имеют приоритет над логикой помощника.

8. API (концептуально)
POST /assistant/respond
{
  "input": "...",
  "context": "business",
  "mode": "analyst",
  "ruleset": "default",
  "initiative_level": "medium"
}
