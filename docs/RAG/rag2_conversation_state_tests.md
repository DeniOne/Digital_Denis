0Ô∏è‚É£ –û–±—â–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≤–∞–∂–Ω–æ)

–ú—ã –ù–ï —Ç–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã –∫–∞–∫ —Ç–µ–∫—Å—Ç.
–ú—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º:

—É–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–º—ã—Å–ª–∞

–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è

–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ¬´–æ—Ç–≤–µ—Ç–∞ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞¬ª

üëâ –ò—Å—Ç–∏–Ω–∞ = —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + –ª–æ–≥–∏–∫–∞, –Ω–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞.

1Ô∏è‚É£ Conversation State ‚Äî Unit Tests
1.1. CS-UNIT-01: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

Given:

–Ω–æ–≤—ã–π Telegram chat_id

–Ω–µ—Ç previous_conversation_state

When:

–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

Then:

—Å–æ–∑–¥–∞—ë—Ç—Å—è CS

topic, goal, intent –ª–∏–±–æ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –ª–∏–±–æ null

active_entities = []

decisions_made = []

‚ùå Fail –µ—Å–ª–∏:

CS –Ω–µ —Å–æ–∑–¥–∞–Ω

topic/goal –≤—ã–¥—É–º–∞–Ω—ã

1.2. CS-UNIT-02: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–º—ã

Given:

topic = "RAG 2.0 architecture"

When:

–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

¬´–æ–∫, –ø–æ–Ω—è–ª¬ª

Then:

topic –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

goal –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

‚ùå Fail –µ—Å–ª–∏:

—Ç–µ–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞

—Ç–µ–º–∞ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞

1.3. CS-UNIT-03: Deixis resolution (¬´—ç—Ç–æ¬ª, ¬´—Ç—É—Ç¬ª)

Given:

active_entities = ["Conversation State", "Redis"]


When:

¬´–∞ –≤–æ—Ç —ç—Ç–æ –ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ¬ª

Then:

active_entities –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

CS —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å

–Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ ¬´—ç—Ç–æ¬ª

‚ùå Fail –µ—Å–ª–∏:

¬´—ç—Ç–æ¬ª –Ω–µ —Å–≤—è–∑–∞–Ω–æ –Ω–∏ —Å —á–µ–º

–ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å –±–µ–∑ –æ—Å–Ω–æ–≤–∞–Ω–∏—è

1.4. CS-UNIT-04: –§–∏–∫—Å–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è

When:

¬´–û–∫, –¥–µ–ª–∞–µ–º Conversation State –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–ª–æ–µ–º RAG 2.0¬ª

Then:

–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ decisions_made

current_step –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä ‚Üí solution_confirmed)

‚ùå Fail –µ—Å–ª–∏:

—Ä–µ—à–µ–Ω–∏–µ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ

—Ä–µ—à–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è

1.5. CS-UNIT-05: TTL-expiry

Given:

CS —Å—Ç–∞—Ä—à–µ TTL (48—á)

When:

–ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

Then:

CS —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

LLM —É–≤–µ–¥–æ–º–ª—ë–Ω, —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —É—Ç—Ä–∞—á–µ–Ω

‚ùå Fail –µ—Å–ª–∏:

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–π CS

LLM –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç ¬´–∫–∞–∫ –±—É–¥—Ç–æ –ø–æ–º–Ω–∏—Ç¬ª

2Ô∏è‚É£ State Extractor Prompt ‚Äî Contract Tests
2.1. SE-01: JSON-only output

Then:

–æ—Ç–≤–µ—Ç = –≤–∞–ª–∏–¥–Ω—ã–π JSON

‚ùå –Ω–µ—Ç markdown

‚ùå –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞

2.2. SE-02: Partial update

Given:

previous_state.topic = "RAG 2.0"

When:

¬´–î–∞–≤–∞–π —Ç–µ–ø–µ—Ä—å –ø—Ä–æ —Ç–µ—Å—Ç—ã¬ª

Then:

topic –æ—Å—Ç–∞—ë—Ç—Å—è "RAG 2.0"

current_step –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚Üí "testing"

‚ùå Fail –µ—Å–ª–∏:

topic –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω

—Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω—É–ª–µ–Ω–æ

2.3. SE-03: Uncertainty handling

When:

—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ

Then:

—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è = null

–Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ–≥–∞–¥–∫–∏

‚ùå Fail –µ—Å–ª–∏:

—Ü–µ–ª—å –∏–ª–∏ —Ç–µ–º–∞ –ø—Ä–∏–¥—É–º–∞–Ω—ã

3Ô∏è‚É£ RAG 2.0 Retrieval ‚Äî Logic Tests
3.1. RAG-RET-01: Intent-aware retrieval

Given:

intent = decision_request

Then:

decision, principle, rule –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

reflection, emotion –ø–æ–Ω–∏–∂–µ–Ω—ã

‚ùå Fail –µ—Å–ª–∏:

—ç–º–æ—Ü–∏–∏ –ø–æ–ø–∞–ª–∏ –≤ —Ç–æ–ø-–∫–æ–Ω—Ç–µ–∫—Å—Ç

3.2. RAG-RET-02: Time decay

Given:

reflection (30 –¥–Ω–µ–π)

reflection (1 –¥–µ–Ω—å)

Then:

—Å–≤–µ–∂–∞—è reflection –≤—ã—à–µ –≤ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–∏

‚ùå Fail –µ—Å–ª–∏:

–≤—Ä–µ–º—è –Ω–µ –≤–ª–∏—è–µ—Ç

3.3. RAG-RET-03: Principle immunity

Given:

principle (2 –≥–æ–¥–∞)

hypothesis (–≤—á–µ—Ä–∞)

Then:

principle –Ω–µ —Ç–µ—Ä—è–µ—Ç –≤–µ—Å

‚ùå Fail –µ—Å–ª–∏:

principle –≤—ã—Ç–µ—Å–Ω–µ–Ω –≥–∏–ø–æ—Ç–µ–∑–æ–π

4Ô∏è‚É£ Context Assembler ‚Äî Integration Tests
4.1. CA-01: Priority order

–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ:

System Rules

Conversation State

Rules / Principles

Facts

Decisions

Last messages

‚ùå Fail –µ—Å–ª–∏:

CS –Ω–∏–∂–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

4.2. CA-02: Conflict surfacing

Given:

–¥–≤–∞ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç

Then:

–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –±–ª–æ–∫ [CONFLICTS]

‚ùå Fail –µ—Å–ª–∏:

–∫–æ–Ω—Ñ–ª–∏–∫—Ç –∑–∞–º–∞–ª—á–∏–≤–∞–µ—Ç—Å—è

5Ô∏è‚É£ End-to-End Telegram Scenarios (–ö–†–ò–¢–ò–ß–ù–û)
5.1. E2E-01: –ö–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

–î–∏–∞–ª–æ–≥:

‚Äî –¥–∞
‚Äî –≤–æ—Ç —Ç—É—Ç
‚Äî –∞ —ç—Ç–æ –ª—É—á—à–µ –æ—Ç–¥–µ–ª—å–Ω–æ
‚Äî –æ–∫, —Ç–æ–≥–¥–∞ —Ç–∞–∫


Then:

–ò–ò —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–º—É

–Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç ¬´–æ —á—ë–º —Ä–µ—á—å¬ª

‚ùå Fail –µ—Å–ª–∏:

¬´—É—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª

5.2. E2E-02: –ü–∞—É–∑—ã

Given:

–ø–∞—É–∑–∞ 10‚Äì30 –º–∏–Ω—É—Ç

Then:

CS —Å–æ—Ö—Ä–∞–Ω—ë–Ω

–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

5.3. E2E-03: –°–º–µ–Ω–∞ –∑–∞–¥–∞—á–∏

When:

¬´–õ–∞–¥–Ω–æ, –¥–∞–≤–∞–π —Ç–µ–ø–µ—Ä—å –ø—Ä–æ Kaizen¬ª

Then:

topic –∏ goal –æ–±–Ω–æ–≤–ª–µ–Ω—ã

—Å—Ç–∞—Ä—ã–µ active_entities –æ—á–∏—â–µ–Ω—ã

‚ùå Fail –µ—Å–ª–∏:

—Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å—Ç–∞—Ä—É—é —Ç–µ–º—É

6Ô∏è‚É£ Anti-Hallucination & Regression Tests
6.1. REG-01: –û—Ç–≤–µ—Ç ¬´—Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞¬ª

‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:

–ø–æ–≤—Ç–æ—Ä—è—Ç—å —É–∂–µ —Å–∫–∞–∑–∞–Ω–Ω–æ–µ

–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

6.2. REG-02: Telegram degradation test

Given:

—Ç–æ–ª—å–∫–æ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è

Then:

–ª–æ–≥–∏–∫–∞ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è

6.3. REG-03: Memory vs State

Then:

CS –≤–∞–∂–Ω–µ–µ –∏—Å—Ç–æ—Ä–∏–∏

–∏—Å—Ç–æ—Ä–∏—è ‚â† –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

7Ô∏è‚É£ QA Summary Criteria (Go / No-Go)

–°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ì–û–¢–û–í–û–ô, –µ—Å–ª–∏:

‚úÖ 0 —Å–ª—É—á–∞–µ–≤ ¬´–æ—Ç–≤–µ—Ç–∞ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞¬ª
‚úÖ CS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ primary context
‚úÖ –ù–µ—Ç –ø—Ä–∏–¥—É–º–∞–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π –∏ —Ç–µ–º
‚úÖ Telegram-—Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã
‚úÖ –†–µ—à–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–æ–±—Å—É–∂–¥–∞—é—Ç—Å—è

üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
–ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É:

CS schema validation

JSON-only output

priority order

TTL logic

–ß—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ä—É—á–Ω—ã–º:

E2E Telegram —Å—Ü–µ–Ω–∞—Ä–∏–∏

–∫–∞—á–µ—Å—Ç–≤–æ —É–¥–µ—Ä–∂–∞–Ω–∏—è —Å–º—ã—Å–ª–∞