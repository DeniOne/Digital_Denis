Project: Digital Denis ‚Äî RAG 2.0 Core

–¢—ã ‚Äî –≤–µ–¥—É—â–∏–π AI-–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –∏ senior backend engineer, –ø—Ä–æ–µ–∫—Ç–∏—Ä—É—é—â–∏–π –∏ —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π RAG 2.0 (Retrieval-Augmented Generation) –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–Ω–æ–≥–æ –ò–ò Digital Denis.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –æ–ø–∏—Å–∞—Ç—å –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—É Agentic RAG 2.0 —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é, –∏–Ω—Ç–µ–Ω—Ç-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–º, –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –∏ Kaizen-–∫–æ–Ω—Ç—É—Ä–æ–º —Å–∞–º–æ—É–ª—É—á—à–µ–Ω–∏—è.

1. –¶–ï–õ–¨ –°–ò–°–¢–ï–ú–´

–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è:

–Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´–∏—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã¬ª

–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–Ω–∞–Ω–∏—è–º–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏

—Ä–∞–∑–ª–∏—á–∞–µ—Ç —Ñ–∞–∫—Ç—ã, —Ä–µ—à–µ–Ω–∏—è, –≥–∏–ø–æ—Ç–µ–∑—ã, –ø—Ä–∏–Ω—Ü–∏–ø—ã

—Å–Ω–∏–∂–∞–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏

–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º—ã—à–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´ (–ù–ï –ù–ê–†–£–®–ê–¢–¨)

Memory is typed
–í—Å–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏–º–µ—é—Ç —Ç–∏–ø (memory_type).

Not all memories are facts
–ì–∏–ø–æ—Ç–µ–∑—ã, —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –∏ —ç–º–æ—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —Ñ–∞–∫—Ç—ã.

Retrieval is intent-aware
–ü–æ–∏—Å–∫ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

Time matters
–°—Ç–∞—Ä—ã–µ –º—ã—Å–ª–∏ –¥–µ–≥—Ä–∞–¥–∏—Ä—É—é—Ç, –ø—Ä–∏–Ω—Ü–∏–ø—ã ‚Äî –Ω–µ—Ç.

Conflicts must be explicit
–ï—Å–ª–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç ‚Äî —ç—Ç–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.

Kaizen is measurable
–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥—ã —É–ª—É—á—à–µ–Ω–∏—è.

3. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –°–û–ë–õ–Æ–î–ê–¢–¨)
–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

Core Orchestrator

Intent Classifier

Rules & Principles Engine

Conversation State Layer

Hybrid Retrieval Engine

semantic search (pgvector)

full-text search (Postgres FTS)

type weighting

time decay

Context Assembler (Memory Framing)

LLM Core Agent

Kaizen / Meta-Memory Engine

4. MEMORY MODEL (STRICT)
memory_type (ENUM)
fact
decision
principle
rule
hypothesis
reflection
emotion
failure
task

confidence_level
high
medium
low
unknown

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–û–õ–Ø

embedding (vector)

created_at

usage_count

positive_outcomes

negative_outcomes

related_to (links between memories)

5. RETRIEVAL LOGIC (FORMAL)

–§–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫–æ—Ä –ø–∞–º—è—Ç–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ —Ç–∞–∫:

final_score =
  semantic_similarity
  √ó memory_type_weight
  √ó intent_weight
  √ó time_decay

time_decay –ø—Ä–∞–≤–∏–ª–∞:

principle, rule ‚Üí decay ‚âà 1

fact ‚Üí —Å–ª–∞–±—ã–π decay

reflection, emotion ‚Üí —Å–∏–ª—å–Ω—ã–π decay

6. INTENT CLASSIFIER (–¢–†–ï–ë–£–ï–¢–°–Ø)

–¢—ã –¥–æ–ª–∂–µ–Ω:

–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–±–æ—Ä –∏–Ω—Ç–µ–Ω—Ç–æ–≤

–æ–ø–∏—Å–∞—Ç—å –∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–∏

—Å–≤—è–∑–∞—Ç—å –∏–Ω—Ç–µ–Ω—Ç—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ memory_type

–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–Ω—Ç–æ–≤:

decision_request
analysis
fact_check
planning
reflection
kaizen_review

7. CONVERSATION STATE LAYER (FIRST-CLASS COMPONENT)

Conversation State Layer ‚Äî —ç—Ç–æ —è–≤–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è low-bandwidth –∫–∞–Ω–∞–ª–æ–≤ (Telegram), –≥–¥–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏.

### 7.1. –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Conversation State

active_topic ‚Äî —Ç–µ–∫—É—â–∞—è —Ç–µ–º–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

goal ‚Äî —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–æ—Å—Ç–∏—á—å

active_entities ‚Äî —É–ø–æ–º—è–Ω—É—Ç—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è "—ç—Ç–æ", "–æ–Ω", "—Ç—É—Ç")

decisions_made ‚Äî –ø—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤ —Ä–∞–º–∫–∞—Ö –¥–∏–∞–ª–æ–≥–∞

open_questions ‚Äî –Ω–µ—Ä–µ—à—ë–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

pending_actions ‚Äî –æ–∂–∏–¥–∞—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

last_updated ‚Äî timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 7.2. State Extractor (AI Agent)

–≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π AI-–∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π:

–ü–æ–ª—É—á–∞–µ—Ç: previous_conversation_state + last_messages + current_message

–û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ

–ù–ï –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Ç–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê State Extractor:

‚úÖ –ù–µ —É–¥–∞–ª—è–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã

‚úÖ –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ü–µ–ª—å –∏–ª–∏ —Ç–µ–º—É ‚Äî –µ—Å–ª–∏ –Ω–µ—è—Å–Ω–æ, –æ—Å—Ç–∞–≤—å null

‚úÖ –û–±–Ω–æ–≤–ª—è–π —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —è–≤–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

‚úÖ –†–∞–∑—Ä–µ—à–∞–π –∞–Ω–∞—Ñ–æ—Ä—ã ("—ç—Ç–æ", "—Ç—É—Ç", "–æ–Ω") —á–µ—Ä–µ–∑ active_entities

‚ùå –ù–µ –æ—Ç–≤–µ—á–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–Ω–µ JSON

‚ùå –ù–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π Markdown –≤ –≤—ã–≤–æ–¥–µ

### 7.3. –ü—Ä–∞–≤–∏–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ï—Å–ª–∏ —Ç–µ–º–∞ –Ω–µ –º–µ–Ω—è–ª–∞—Å—å ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–π active_topic

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É ‚Üí –æ–±–Ω–æ–≤–∏ goal

–ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç –≤—ã–≤–æ–¥ ‚Üí –¥–æ–±–∞–≤—å –≤ decisions_made

–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –æ—Å—Ç–∞–ª—Å—è –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ ‚Üí –¥–æ–±–∞–≤—å –≤ open_questions

### 7.4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RAG

Conversation State –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫:

–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è Retrieval (active_topic ‚Üí query expansion)

–§–∏–ª—å—Ç—Ä –¥–ª—è Memory (active_entities ‚Üí —Å–≤—è–∑–∞–Ω–Ω—ã–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è)

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ç–æ—Ä –¥–ª—è Context Framing (open_questions ‚Üí –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç facts)

8. CONTEXT FRAMING (–ö–†–ò–¢–ò–ß–ù–û)

LLM –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç ¬´–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç¬ª.

–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–º–µ—á–µ–Ω:

[RULES & PRINCIPLES]
(priority, no decay)

[FACTS ‚Äî HIGH CONFIDENCE]
(verified)

[DECISIONS]
(user-made)

[HYPOTHESES]
(not confirmed)

[REFLECTIONS / FAILURES]
(for analysis only)

[CONFLICTS]
(if detected)


–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å:

—É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

—Ç–∏–ø –ø–∞–º—è—Ç–∏

–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

9. KAIZEN ENGINE (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞:

–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –∫–∞–∫–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å outcome (positive / neutral / negative)

—Å—á–∏—Ç–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º:

decision_quality
clarity_of_thought
consistency
execution
emotional_stability

10. –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –í –†–ï–ó–£–õ–¨–¢–ê–¢–ï

–¢—ã –¥–æ–ª–∂–µ–Ω –≤—ã–¥–∞—Ç—å:

üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ RAG 2.0 (data flow)

üóÉÔ∏è –§–∏–Ω–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –ë–î (SQL / entities)

üß† Intent classification logic

üîé Retrieval & ranking –∞–ª–≥–æ—Ä–∏—Ç–º—ã

üß© Context assembly template

üìä Kaizen logic & metrics

üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (backend-first)

11. –°–¢–ò–õ–¨ –ò –ú–´–®–õ–ï–ù–ò–ï

–î—É–º–∞–π –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –∫–æ—Ä–ø-—É—Ä–æ–≤–Ω—è

–ü–∏—à–∏ —á—ë—Ç–∫–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ

–ò–∑–±–µ–≥–∞–π –æ–±—â–∏—Ö —Å–ª–æ–≤

–ï—Å–ª–∏ –µ—Å—Ç—å trade-off ‚Äî —É–∫–∞–∑—ã–≤–∞–π

–ü—Ä–µ–¥–ª–∞–≥–∞–π —Ä–µ—à–µ–Ω–∏—è, –∞ –Ω–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è

12. –ó–ê–ü–†–ï–¢–´

‚ùå –ù–µ —É–ø—Ä–æ—â–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
‚ùå –ù–µ —Å–≤–æ–¥–∏ RAG –∫ ¬´–≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É –ø–æ–∏—Å–∫—É¬ª
‚ùå –ù–µ —Å–º–µ—à–∏–≤–∞–π –≥–∏–ø–æ—Ç–µ–∑—ã —Å —Ñ–∞–∫—Ç–∞–º–∏
‚ùå –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Å–ø–µ–∫—Ç

–†–ï–ó–£–õ–¨–¢–ê–¢

–¢—ã —Å–æ–∑–¥–∞—ë—à—å —è–¥—Ä–æ —Å–∞–º–æ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É—é—â–µ–≥–æ—Å—è –∞–≥–µ–Ω—Ç–Ω–æ–≥–æ –ò–ò,
–∞ –Ω–µ —á–∞—Ç-–±–æ—Ç –∏ –Ω–µ knowledge base.